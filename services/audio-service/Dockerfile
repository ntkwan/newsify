FROM python:3.11-slim

ARG ENV
ARG OPENAI_API_KEY
ARG OPENAI_ENDPOINT
ARG OPENAI_MODEL
ARG OPENAI_TTS_MODEL
ARG OPENAI_TRANSCRIPTION_MODEL
ARG OPENAI_TEMPERATURE
ARG GOOGLE_GEMINI_API_KEY
ARG GOOGLE_GEMINI_MODEL
ARG DB_NAME
ARG DB_PORT
ARG DATABASE
ARG DB_USERNAME
ARG DB_PASSWORD
ARG DB_DIALECT
ARG DO_DB_NAME
ARG DO_DB_PORT
ARG DO_DB_HOST
ARG DO_DB_USERNAME
ARG DO_DB_PASSWORD
ARG DO_SPACES_ACCESS_KEY
ARG DO_SPACES_SECRET_KEY
ARG DO_SPACES_BUCKET
ARG DO_SPACES_ENDPOINT
ARG REDIS_HOST
ARG REDIS_PORT
ARG REDIS_USER
ARG REDIS_PASSWORD
ARG REDIS_CHANNEL

ENV ENV=${ENV}
ENV OPENAI_API_KEY=${OPENAI_API_KEY}
ENV OPENAI_ENDPOINT=${OPENAI_ENDPOINT}
ENV OPENAI_MODEL=${OPENAI_MODEL}
ENV OPENAI_TTS_MODEL=${OPENAI_TTS_MODEL}
ENV OPENAI_TRANSCRIPTION_MODEL=${OPENAI_TRANSCRIPTION_MODEL}
ENV OPENAI_TEMPERATURE=${OPENAI_TEMPERATURE}
ENV GOOGLE_GEMINI_API_KEY=${GOOGLE_GEMINI_API_KEY}
ENV GOOGLE_GEMINI_MODEL=${GOOGLE_GEMINI_MODEL}
ENV DB_NAME=${DB_NAME}
ENV DB_PORT=${DB_PORT}
ENV DATABASE=${DATABASE}
ENV DB_USERNAME=${DB_USERNAME}
ENV DB_PASSWORD=${DB_PASSWORD}
ENV DB_DIALECT=${DB_DIALECT}
ENV DO_DB_NAME=${DO_DB_NAME}
ENV DO_DB_PORT=${DO_DB_PORT}
ENV DO_DB_HOST=${DO_DB_HOST}
ENV DO_DB_USERNAME=${DO_DB_USERNAME}
ENV DO_DB_PASSWORD=${DO_DB_PASSWORD}
ENV DO_SPACES_ACCESS_KEY=${DO_SPACES_ACCESS_KEY}
ENV DO_SPACES_SECRET_KEY=${DO_SPACES_SECRET_KEY}
ENV DO_SPACES_BUCKET=${DO_SPACES_BUCKET}
ENV DO_SPACES_ENDPOINT=${DO_SPACES_ENDPOINT}
ENV REDIS_HOST=${REDIS_HOST}   
ENV REDIS_PORT=${REDIS_PORT}
ENV REDIS_USER=${REDIS_USER}
ENV REDIS_PASSWORD=${REDIS_PASSWORD}
ENV REDIS_CHANNEL=${REDIS_CHANNEL}

WORKDIR /app

RUN echo ".env\n__pycache__\n*.pyc\n*.pyo\n*.pyd\n.Python\n.coverage\nenv/\nvenv/\n.git/\n.gitignore" > .dockerignore

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]